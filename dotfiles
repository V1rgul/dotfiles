#!/usr/bin/env bash

files=(
	.bashrc
	.bash_aliases 

#	.oh-my-zsh
	.zshrc

#	.gconf/apps/gnome-terminal/profiles

#	.fonts
)

command=$1

usage()
{
cat << EOF
usage: $0 {save|install|show}
	save	: Save current dotfiles to "files" folder
	install	: Install dotfiles in "files" folder to \$HOME
	show	: show differences beetween \$Home and "files" folder
EOF
}

DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
savedir="${DIR}/files"

set -e


for f in ${files[@]}; do
	if [ "$command" == "save" ] || [ "$command" == "show" ]; then
		from="${HOME}/${f}"
		to="${savedir}/${f}"
	elif [ "$command" == "install" ]; then
		from="${savedir}/${f}"
		to="${HOME}/${f}"
	else
		usage
		exit -1
	fi

	echo "$f"
	if [ "$command" == "show" ]; then
		colordiff -u --new-file --recursive --minimal "$to" "$from"
	else
		todir=$(dirname "${to}" | head -n 1)
		mkdir -p $todir
		rsync -rhL "$from" "$todir"
	fi
	#--out-format="%f"
done

if [ "$command" == "save" ]; then
	git status ${savedir}
fi



